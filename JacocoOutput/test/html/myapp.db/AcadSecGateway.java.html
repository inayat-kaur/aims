<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AcadSecGateway.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">myapp.db</a> &gt; <span class="el_source">AcadSecGateway.java</span></div><h1>AcadSecGateway.java</h1><pre class="source lang-java linenums">package myapp.db;

import java.sql.*;

//All interactions of AcadSec to the database occur via this class

public class AcadSecGateway {

    private String username;
    private Connection conn;

<span class="fc" id="L12">    public AcadSecGateway(String username) {</span>
<span class="fc" id="L13">        this.username = username;</span>
<span class="fc" id="L14">        this.conn = DatabaseConnection.connectToServer();</span>
<span class="fc" id="L15">    }</span>

    public int getCurrentYear() throws SQLException {
<span class="fc" id="L18">        PreparedStatement st = conn.prepareStatement(&quot;select year from current_event where event = 'ongoing'&quot;);</span>
<span class="fc" id="L19">        ResultSet res = st.executeQuery();</span>
<span class="fc bfc" id="L20" title="All 2 branches covered.">        if (res.next()) {</span>
<span class="fc" id="L21">            return res.getInt(&quot;year&quot;);</span>
        }
<span class="fc" id="L23">        return 0;</span>
    }

    public int getCurrentSem() throws SQLException {
<span class="fc" id="L27">        PreparedStatement st = conn.prepareStatement(&quot;select sem from current_event where event = 'ongoing'&quot;);</span>
<span class="fc" id="L28">        ResultSet res = st.executeQuery();</span>
<span class="fc bfc" id="L29" title="All 2 branches covered.">        if (res.next()) {</span>
<span class="fc" id="L30">            return res.getInt(&quot;sem&quot;);</span>
        }
<span class="fc" id="L32">        return 0;</span>
    }

    public boolean checkEvent(String event) throws SQLException {
<span class="fc" id="L36">        PreparedStatement st = conn</span>
<span class="fc" id="L37">                .prepareStatement(&quot;select * from current_event where event = ? and sem =? and year = ?&quot;);</span>
<span class="fc" id="L38">        st.setString(1, event);</span>
<span class="fc" id="L39">        st.setInt(2, getCurrentSem());</span>
<span class="fc" id="L40">        st.setInt(3, getCurrentYear());</span>
<span class="fc" id="L41">        ResultSet res = st.executeQuery();</span>
<span class="fc bfc" id="L42" title="All 2 branches covered.">        if (res.next()) {</span>
<span class="fc" id="L43">            return true;</span>
        }
<span class="fc" id="L45">        return false;</span>
    }

    public void addEvent(String event, Date starDate, Date endDate) throws SQLException {
<span class="fc" id="L49">        PreparedStatement st = conn.prepareStatement(&quot;insert into current_event values(?, ?, ?, ?, ?)&quot;);</span>
<span class="fc" id="L50">        st.setString(1, event);</span>
<span class="fc" id="L51">        st.setInt(2, getCurrentSem());</span>
<span class="fc" id="L52">        st.setInt(3, getCurrentYear());</span>
<span class="fc" id="L53">        st.setDate(4, starDate);</span>
<span class="fc" id="L54">        st.setDate(5, endDate);</span>
<span class="fc" id="L55">        st.executeUpdate();</span>
<span class="fc" id="L56">        System.out.println(&quot;Event added&quot;);</span>
<span class="fc" id="L57">    }</span>

    public void removeEvent(String event) throws SQLException {
<span class="fc" id="L60">        PreparedStatement st = conn</span>
<span class="fc" id="L61">                .prepareStatement(&quot;delete from current_event where event = ? and sem = ? and year = ?&quot;);</span>
<span class="fc" id="L62">        st.setString(1, event);</span>
<span class="fc" id="L63">        st.setInt(2, getCurrentSem());</span>
<span class="fc" id="L64">        st.setInt(3, getCurrentYear());</span>
<span class="fc" id="L65">        st.executeUpdate();</span>
<span class="fc" id="L66">        System.out.println(&quot;Event removed&quot;);</span>
<span class="fc" id="L67">    }</span>

    public void updateSem(Date startDate, Date endDate) throws SQLException {
<span class="fc" id="L70">        PreparedStatement st = conn.prepareStatement(&quot;update current_event set event = 'completed' where event = 'ongoing'&quot;);</span>
<span class="fc" id="L71">        st.executeUpdate();</span>
<span class="fc" id="L72">        int nextYear = getCurrentYear();</span>
<span class="fc" id="L73">        int nextSem = getCurrentSem() + 1;</span>
<span class="pc bpc" id="L74" title="1 of 2 branches missed.">        if (nextSem &gt; 2) {</span>
<span class="nc" id="L75">            nextSem = 1;</span>
<span class="nc" id="L76">            nextYear = nextYear + 1;</span>
        }
<span class="fc" id="L78">        st = conn.prepareStatement(&quot;insert into current_event values(?, ?, ?, ?, ?)&quot;);</span>
<span class="fc" id="L79">        st.setString(1, &quot;ongoing&quot;);</span>
<span class="fc" id="L80">        st.setInt(2, nextSem);</span>
<span class="fc" id="L81">        st.setInt(3, nextYear);</span>
<span class="fc" id="L82">        st.setDate(4, startDate);</span>
<span class="fc" id="L83">        st.setDate(5, endDate);</span>
<span class="fc" id="L84">        st.executeUpdate();</span>
<span class="fc" id="L85">        System.out.println(&quot;Semester updated&quot;);</span>
<span class="fc" id="L86">    }</span>

    public int getStudentSem(String student_id) throws SQLException {
<span class="fc" id="L89">        PreparedStatement st = conn.prepareStatement(&quot;select year_of_entry from students where student_id = ?&quot;);</span>
<span class="fc" id="L90">        st.setString(1, student_id);</span>
<span class="fc" id="L91">        ResultSet res = st.executeQuery();</span>
<span class="fc bfc" id="L92" title="All 2 branches covered.">        if (res.next()) {</span>
<span class="fc" id="L93">            return (getCurrentYear() - res.getInt(&quot;year_of_entry&quot;)) * 2 + getCurrentSem() - 1;</span>
        }
<span class="fc" id="L95">        return 0;</span>
    }

    public ResultSet getGrades(String student_id) throws SQLException {
<span class="fc" id="L99">        PreparedStatement st = conn.prepareStatement(&quot;select * from grades where student_id = ?&quot;);</span>
<span class="fc" id="L100">        st.setString(1, student_id);</span>
<span class="fc" id="L101">        return st.executeQuery();</span>
    }

    public ResultSet getSemGrades(String student_id, int studentSem) throws SQLException {
<span class="fc" id="L105">        int sem = getCurrentSem();</span>
<span class="fc" id="L106">        int year = getCurrentYear();</span>
<span class="fc" id="L107">        int diff = getStudentSem(student_id) - studentSem;</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">        if (diff % 2 == 1) {</span>
<span class="pc bpc" id="L109" title="1 of 2 branches missed.">            if(sem==2)year -= diff / 2;</span>
<span class="fc" id="L110">            else year -= 1+diff/2;</span>
<span class="fc" id="L111">            sem = 3 - sem;</span>
        } else {
<span class="fc" id="L113">            year -= diff / 2;</span>
        }
<span class="fc" id="L115">        PreparedStatement st = conn</span>
<span class="fc" id="L116">                .prepareStatement(&quot;select * from grades where student_id = ? and sem = ? and year = ?&quot;);</span>
<span class="fc" id="L117">        st.setString(1, student_id);</span>
<span class="fc" id="L118">        st.setInt(2, sem);</span>
<span class="fc" id="L119">        st.setInt(3, year);</span>
<span class="fc" id="L120">        return st.executeQuery();</span>
    }

    public boolean checkAuthority() throws SQLException {
<span class="fc" id="L124">        PreparedStatement st = conn.prepareStatement(&quot;select * from users where username = ? and role = 0&quot;);</span>
<span class="fc" id="L125">        st.setString(1, username);</span>
<span class="fc" id="L126">        ResultSet res = st.executeQuery();</span>
<span class="fc bfc" id="L127" title="All 2 branches covered.">        if (res.next()) {</span>
<span class="fc" id="L128">            return true;</span>
        }
<span class="fc" id="L130">        return false;</span>
    }

    public boolean checkCourse(String course_id) throws SQLException {
<span class="fc" id="L134">        PreparedStatement st = conn.prepareStatement(&quot;select * from courses where course_id = ?&quot;);</span>
<span class="fc" id="L135">        st.setString(1, course_id);</span>
<span class="fc" id="L136">        ResultSet res = st.executeQuery();</span>
<span class="fc bfc" id="L137" title="All 2 branches covered.">        if (res.next()) {</span>
<span class="fc" id="L138">            return true;</span>
        }
<span class="fc" id="L140">        return false;</span>
    }

    public void addCourse(String course_id, String dept, String ltpc, String pre) throws SQLException {
<span class="fc" id="L144">        String[] parts = ltpc.split(&quot;-&quot;);</span>
<span class="fc" id="L145">        int L = Integer.parseInt(parts[0]);</span>
<span class="fc" id="L146">        int T = Integer.parseInt(parts[1]);</span>
<span class="fc" id="L147">        int P = Integer.parseInt(parts[2]);</span>
<span class="fc" id="L148">        float C = Float.parseFloat(parts[3]);</span>
        String[][] pre_req;
<span class="fc" id="L150">        String[][] padded = null;</span>
<span class="fc bfc" id="L151" title="All 2 branches covered.">        if (pre.equals(&quot;NaN&quot;)) {</span>
<span class="fc" id="L152">            pre_req = null;</span>
        } else {
<span class="fc" id="L154">            String[] parts2 = pre.split(&quot;\\|&quot;);</span>
<span class="fc" id="L155">            pre_req = new String[parts2.length][];</span>
<span class="fc" id="L156">            int maxLength = 0;</span>
<span class="fc bfc" id="L157" title="All 2 branches covered.">            for (int i = 0; i &lt; parts2.length; i++) {</span>
<span class="fc" id="L158">                pre_req[i] = parts2[i].split(&quot;,&quot;);</span>
<span class="fc bfc" id="L159" title="All 2 branches covered.">                if (pre_req[i].length &gt; maxLength) {</span>
<span class="fc" id="L160">                    maxLength = pre_req[i].length;</span>
                }
            }
<span class="fc" id="L163">            padded = new String[pre_req.length][maxLength];</span>
<span class="fc bfc" id="L164" title="All 2 branches covered.">            for (int i = 0; i &lt; pre_req.length; i++) {</span>
<span class="fc bfc" id="L165" title="All 2 branches covered.">                for (int j = 0; j &lt; maxLength; j++) {</span>
<span class="pc bpc" id="L166" title="1 of 2 branches missed.">                    if (j &lt; pre_req[i].length) {</span>
<span class="fc" id="L167">                        padded[i][j] = pre_req[i][j];</span>
                    } else {
<span class="nc" id="L169">                        padded[i][j] = &quot;&quot;;</span>
                    }
                }
            }
        }
<span class="fc" id="L174">        PreparedStatement st = conn.prepareStatement(&quot;insert into courses values(?, ?, ?, ?, ?, ?,?)&quot;);</span>
<span class="fc" id="L175">        st.setString(1, course_id);</span>
<span class="fc" id="L176">        st.setString(2, dept);</span>
<span class="fc" id="L177">        st.setInt(3, L);</span>
<span class="fc" id="L178">        st.setInt(4, T);</span>
<span class="fc" id="L179">        st.setInt(5, P);</span>
<span class="fc" id="L180">        st.setFloat(6, C);</span>
<span class="fc" id="L181">        st.setObject(7, padded);</span>
<span class="fc" id="L182">        st.executeUpdate();</span>
<span class="fc" id="L183">        System.out.println(&quot;Course added&quot;);</span>
<span class="fc" id="L184">    }</span>

    public void removeCourse(String course_id) throws SQLException {
<span class="fc" id="L187">        PreparedStatement st = conn.prepareStatement(&quot;delete from courses where course_id = ?&quot;);</span>
<span class="fc" id="L188">        st.setString(1, course_id);</span>
<span class="fc" id="L189">        st.executeUpdate();</span>
<span class="fc" id="L190">        System.out.println(&quot;Course removed&quot;);</span>
<span class="fc" id="L191">    }</span>

    public void addDegreeCriteria(String dept, String program, String[] programCore, float programElective, float humanitiesElective,
            float scienceElective, float openElective, String[] btp)
            throws SQLException {
<span class="fc" id="L196">        int year = getCurrentYear();</span>
<span class="fc" id="L197">        PreparedStatement st = conn.prepareStatement(&quot;insert into degree_criteria values(?, ?, ?, ?, ?, ?, ?, ?, ?)&quot;);</span>
<span class="fc" id="L198">        st.setInt(1, year);</span>
<span class="fc" id="L199">        st.setString(2, dept);</span>
<span class="fc" id="L200">        st.setString(3, program);</span>
<span class="fc" id="L201">        st.setObject(4, programCore);</span>
<span class="fc" id="L202">        st.setFloat(5, programElective);</span>
<span class="fc" id="L203">        st.setFloat(6, humanitiesElective);</span>
<span class="fc" id="L204">        st.setFloat(7, scienceElective);</span>
<span class="fc" id="L205">        st.setFloat(8, openElective);</span>
<span class="fc" id="L206">        st.setObject(9, btp);</span>
<span class="fc" id="L207">        st.executeUpdate();</span>
<span class="fc" id="L208">        System.out.println(&quot;Degree criteria added&quot;);</span>
<span class="fc" id="L209">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>