<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FacultyGateway.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">myapp.db</a> &gt; <span class="el_source">FacultyGateway.java</span></div><h1>FacultyGateway.java</h1><pre class="source lang-java linenums">package myapp.db;
 
import java.sql.*;
import java.util.ArrayList;

//All interactions of Faculty to the database occur via this class

public class FacultyGateway {
    private String username;
    private Connection conn;

<span class="fc" id="L12">    public FacultyGateway(String username) {</span>
<span class="fc" id="L13">        this.username = username;</span>
<span class="fc" id="L14">        this.conn = DatabaseConnection.connectToServer();</span>
<span class="fc" id="L15">    }</span>

    public String getName() throws SQLException {
<span class="fc" id="L18">        PreparedStatement st = conn.prepareStatement(&quot;select name from faculty where faculty_id = ?&quot;);</span>
<span class="fc" id="L19">        st.setString(1, username);</span>
<span class="fc" id="L20">        ResultSet res = st.executeQuery();</span>
<span class="fc bfc" id="L21" title="All 2 branches covered.">        if (res.next()) {</span>
<span class="fc" id="L22">            return res.getString(&quot;name&quot;);</span>
        }
<span class="fc" id="L24">        return null;</span>
    }

    public void updatePhone(String phone) throws SQLException {
<span class="fc" id="L28">        PreparedStatement st = conn.prepareStatement(&quot;update faculty set phone = ? where faculty_id = ?&quot;);</span>
<span class="fc" id="L29">        st.setString(1, phone);</span>
<span class="fc" id="L30">        st.setString(2, username);</span>
<span class="fc" id="L31">        st.executeUpdate();</span>
<span class="fc" id="L32">        System.out.println(&quot;Phone number updated successfully&quot;);</span>
<span class="fc" id="L33">    }</span>

    public void updateAddress(String address) throws SQLException {
<span class="fc" id="L36">        PreparedStatement st = conn.prepareStatement(&quot;update faculty set address = ? where faculty_id = ?&quot;);</span>
<span class="fc" id="L37">        st.setString(1, address);</span>
<span class="fc" id="L38">        st.setString(2, username);</span>
<span class="fc" id="L39">        st.executeUpdate();</span>
<span class="fc" id="L40">        System.out.println(&quot;Address updated successfully&quot;);</span>
<span class="fc" id="L41">    }</span>

    public int getCurrentYear() throws SQLException {
<span class="fc" id="L44">        PreparedStatement st = conn.prepareStatement(&quot;select year from current_event where event = 'ongoing'&quot;);</span>
<span class="fc" id="L45">        ResultSet res = st.executeQuery();</span>
<span class="pc bpc" id="L46" title="1 of 2 branches missed.">        if (res.next()) {</span>
<span class="fc" id="L47">            return res.getInt(&quot;year&quot;);</span>
        }
<span class="nc" id="L49">        return 0;</span>
    }

    public int getCurrentSem() throws SQLException {
<span class="fc" id="L53">        PreparedStatement st = conn.prepareStatement(&quot;select sem from current_event where event = 'ongoing'&quot;);</span>
<span class="fc" id="L54">        ResultSet res = st.executeQuery();</span>
<span class="pc bpc" id="L55" title="1 of 2 branches missed.">        if (res.next()) {</span>
<span class="fc" id="L56">            return res.getInt(&quot;sem&quot;);</span>
        }
<span class="nc" id="L58">        return 0;</span>
    }

    public boolean checkEvent(String event) throws SQLException {
<span class="fc" id="L62">        PreparedStatement st = conn</span>
<span class="fc" id="L63">                .prepareStatement(&quot;select * from current_event where event = ? and sem=? and year=?&quot;);</span>
<span class="fc" id="L64">        st.setString(1, event);</span>
<span class="fc" id="L65">        st.setInt(2, getCurrentSem());</span>
<span class="fc" id="L66">        st.setInt(3, getCurrentYear());</span>
<span class="fc" id="L67">        ResultSet res = st.executeQuery();</span>
<span class="fc bfc" id="L68" title="All 2 branches covered.">        if (res.next()) {</span>
<span class="fc" id="L69">            return true;</span>
        }
<span class="fc" id="L71">        return false;</span>
    }

    public float getCourseCredits(String course_id) throws SQLException {
<span class="fc" id="L75">        PreparedStatement st = conn.prepareStatement(&quot;select C from courses where course_id = ?&quot;);</span>
<span class="fc" id="L76">        st.setString(1, course_id);</span>
<span class="fc" id="L77">        ResultSet res = st.executeQuery();</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">        if (res.next()) {</span>
<span class="fc" id="L79">            return res.getFloat(&quot;C&quot;);</span>
        }
<span class="nc" id="L81">        return 0f;</span>
    }

    public boolean checkIfOffered(String course_id) throws SQLException {
<span class="fc" id="L85">        PreparedStatement st = conn.prepareStatement(</span>
                &quot;select * from offering where course_id = ? and faculty_id = ? and sem = ? and year = ?&quot;);
<span class="fc" id="L87">        st.setString(1, course_id);</span>
<span class="fc" id="L88">        st.setString(2, username);</span>
<span class="fc" id="L89">        st.setInt(3, getCurrentSem());</span>
<span class="fc" id="L90">        st.setInt(4, getCurrentYear());</span>
<span class="fc" id="L91">        ResultSet res = st.executeQuery();</span>
<span class="fc bfc" id="L92" title="All 2 branches covered.">        if (res.next()) {</span>
<span class="fc" id="L93">            return true;</span>
        }
<span class="fc" id="L95">        return false;</span>
    }

    public void registerCourse(String course_id, float cg_constraint) throws SQLException {
<span class="fc" id="L99">        String query = &quot;INSERT INTO offering VALUES (?,?,?,?,?)&quot;;</span>
<span class="fc" id="L100">        PreparedStatement stmt = conn.prepareStatement(query);</span>
<span class="fc" id="L101">        stmt.setString(1, course_id);</span>
<span class="fc" id="L102">        stmt.setInt(2, getCurrentSem());</span>
<span class="fc" id="L103">        stmt.setInt(3, getCurrentYear());</span>
<span class="fc" id="L104">        stmt.setString(4, username);</span>
<span class="fc" id="L105">        stmt.setFloat(5, cg_constraint);</span>
<span class="fc" id="L106">        stmt.executeUpdate();</span>
<span class="fc" id="L107">        System.out.println(&quot;Course registered successfully&quot;);</span>
<span class="fc" id="L108">    }</span>

    public void deregisterStudents(String course_id) throws SQLException {
<span class="fc" id="L111">        PreparedStatement st = conn</span>
<span class="fc" id="L112">                .prepareStatement(&quot;delete from student_course where course_id = ? and sem = ? and year = ?&quot;);</span>
<span class="fc" id="L113">        st.setString(1, course_id);</span>
<span class="fc" id="L114">        st.setInt(2, getCurrentSem());</span>
<span class="fc" id="L115">        st.setInt(3, getCurrentYear());</span>
<span class="fc" id="L116">        st.executeUpdate();</span>
<span class="fc" id="L117">        System.out.println(&quot;Students deregistered successfully&quot;);</span>
<span class="fc" id="L118">    }</span>

    public void deregisterCourse(String course_id) throws SQLException {
<span class="fc" id="L121">        String query = &quot;DELETE FROM offering WHERE course_id = ? AND faculty_id = ? and sem = ? and year = ?&quot;;</span>
<span class="fc" id="L122">        PreparedStatement stmt = conn.prepareStatement(query);</span>
<span class="fc" id="L123">        stmt.setString(1, course_id);</span>
<span class="fc" id="L124">        stmt.setString(2, username);</span>
<span class="fc" id="L125">        stmt.setInt(3, getCurrentSem());</span>
<span class="fc" id="L126">        stmt.setInt(4, getCurrentYear());</span>
<span class="fc" id="L127">        stmt.executeUpdate();</span>
<span class="fc" id="L128">        System.out.println(&quot;Course deregistered successfully&quot;);</span>
<span class="fc" id="L129">    }</span>

    public ResultSet getGrades(String course_id, int year, int sem) throws SQLException {
<span class="fc" id="L132">        PreparedStatement st = conn</span>
<span class="fc" id="L133">                .prepareStatement(&quot;select student_id, grade from grades where course_id = ? and year = ? and sem = ?&quot;);</span>
<span class="fc" id="L134">        st.setString(1, course_id);</span>
<span class="fc" id="L135">        st.setInt(2, year);</span>
<span class="fc" id="L136">        st.setInt(3, sem);</span>
<span class="fc" id="L137">        ResultSet res = st.executeQuery();</span>
<span class="fc" id="L138">        return res;</span>
    }

    public void updateGrades(ArrayList&lt;String&gt; student_id, ArrayList&lt;Integer&gt; grades, String course_id)
            throws SQLException {
<span class="fc" id="L143">        String query = &quot;insert into grades values (?,?,?,?,?,?)&quot;;</span>
<span class="fc" id="L144">        String query2 = &quot;update student_course set status = ? where student_id = ? and course_id = ? and sem = ? and year = ?&quot;;</span>
<span class="fc" id="L145">        PreparedStatement st = conn.prepareStatement(query);</span>
<span class="fc" id="L146">        st.setString(2, course_id);</span>
<span class="fc" id="L147">        st.setFloat(3, getCourseCredits(course_id));</span>
<span class="fc" id="L148">        st.setInt(4, getCurrentSem());</span>
<span class="fc" id="L149">        st.setInt(5, getCurrentYear());</span>
<span class="fc" id="L150">        PreparedStatement st2 = conn.prepareStatement(query2);</span>
<span class="fc" id="L151">        st2.setString(3, course_id);</span>
<span class="fc" id="L152">        st2.setInt(4, getCurrentSem());</span>
<span class="fc" id="L153">        st2.setInt(5, getCurrentYear());</span>
<span class="fc bfc" id="L154" title="All 2 branches covered.">        for (int i = 0; i &lt; student_id.size(); i++) {</span>
<span class="fc" id="L155">            st.setString(1, student_id.get(i));</span>
<span class="fc" id="L156">            st.setInt(6, grades.get(i));</span>
<span class="fc" id="L157">            st.executeUpdate();</span>
<span class="fc" id="L158">            st2.setString(2, student_id.get(i));</span>
<span class="pc bpc" id="L159" title="1 of 2 branches missed.">            if (grades.get(i) &gt;= 4) {</span>
<span class="fc" id="L160">                st2.setString(1, &quot;C&quot;);</span>
            } else {
<span class="nc" id="L162">                st2.setString(1, &quot;F&quot;);</span>
            }
<span class="fc" id="L164">            st2.executeUpdate();</span>
        }
<span class="fc" id="L166">        System.out.println(&quot;Grades updated successfully&quot;);</span>
<span class="fc" id="L167">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>